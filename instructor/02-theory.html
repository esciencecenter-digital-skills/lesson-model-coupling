<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Model Coupling: Model coupling theory: the Multiscale Modelling and Simulation Framework</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="manifest" href="../site.webmanifest"><link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><abbr class="icon" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="text-decoration: unset">
           
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #383838">Pre-Alpha
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="color: #FF4955; border-radius: 5px"></i>
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../02-theory.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Model Coupling
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Model Coupling
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Model Coupling
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 25%" class="percentage">
    25%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 25%" aria-valuenow="25" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../02-theory.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-introduction.html">1. Introduction to model coupling</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        2. Model coupling theory: the Multiscale Modelling and Simulation Framework
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#introduction">Introduction</a></li>
<li><a href="#domains">Domains</a></li>
<li><a href="#scales">Scales</a></li>
<li><a href="#models-and-the-submodel-execution-loop">Models and the Submodel Execution Loop</a></li>
<li><a href="#temporal-domain-and-scale-relations">Temporal domain and scale relations</a></li>
<li><a href="#coupling-templates">Coupling Templates</a></li>
<li><a href="#spatial-domains-scales-and-multiplicity">Spatial domains, scales and multiplicity</a></li>
<li><a href="#mmsl-diagrams">MMSL Diagrams</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-muscle-connect.html">3. MUSCLE3 - connecting a model to MUSCLE</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-muscle-couple.html">4. MUSCLE3 - coupling and running</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="../instructor/aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/01-introduction.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/03-muscle-connect.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/01-introduction.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Introduction to
        </a>
        <a class="chapter-link float-end" href="../instructor/03-muscle-connect.html" rel="next">
          Next: MUSCLE3 - connecting... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Model coupling theory: the Multiscale Modelling and Simulation Framework</h1>
        <p> Last updated on 2022-10-31 | 
        
        <a href="https://github.com/esciencecenter-digital-skills/lesson-model-coupling/edit/main/episodes/02-theory.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 45 minutes </p>
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>When coupling models together, how do you figure out which information needs to be exchanged when?</li>
<li>How does that depend on the spatial and temporal scales of the simulated processes?</li>
<li>What does that mean for how submodels should be implemented?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Explain how to couple models using the concepts of the Multiscale Modelling and Simulation Framework</li>
</ul></div>
</div>
</div>
</div>
</div>
<section id="introduction"><h2 class="section-heading">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width"><p>Coupling models can be a difficult task, especially when there are many models involved that model processes in different ways and at different scales in time and space. To make a coupled simulation, you need to figure out which information needs to be passed between which submodels, when it needs to be sent and received, and how it can be represented, and that can be quite a puzzle. Fortunately, there is a theory of model coupling that can help you with this. It is called the Multiscale Modelling and Simulation Framework (MMSF), and despite its name, it also includes same-scale couplings.</p>
<p>In this episode, we’ll work through a slightly extended version of the MMSF’s process for coupling two models representing two processes.</p>
</section><section id="domains"><h2 class="section-heading">Domains<a class="anchor" aria-label="anchor" href="#domains"></a>
</h2>
<hr class="half-width"><div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Instructor Note
  </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<ul><li>Where process takes place</li>
<li>When process starts and ends (convergence, repetition)</li>
<li>Partly a modelling decision</li>
</ul></div>
</div>
</div>
</div>
<p>Mathematical and simulation models represent some kind of process, which takes place in a certain location in time and in space: its domain. The weather takes place in the atmosphere, earthquakes in the Earth’s crust, a forest fire in a forest. In time, that forest fire begins with a lightning strike and ends when the flames are extinguished, and even continuous processes like the airflow around an aeroplane wing can be considered to start when circumstances change and end when a steady state is reached again.</p>
<p>The domains of two models can be the <em>same</em>, <em>overlapping</em>, <em>adjacent</em>, or <em>separated</em>, in both space and time. This is important for the coupling between them, because it decides what is sent (state or boundary conditions) and when it is sent.</p>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Instructor Note
  </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" aria-labelledby="headingInstructor2" data-bs-parent="#accordionInstructor2">
<div class="accordion-body">
<ul><li>Collect in shared document</li>
<li>Discuss questions</li>
</ul></div>
</div>
</div>
</div>
<div id="challenge-1-models-and-domains" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-models-and-domains" class="callout-inner">
<h3 class="callout-title">Challenge 1: Models and domains<a class="anchor" aria-label="anchor" href="#challenge-1-models-and-domains"></a>
</h3>
<div class="callout-content">
<p>Think of two models that could potentially be coupled, and describe each model’s domain in time and space and the relation between them.</p>
<p>Some things to ponder:</p>
<ul><li>What does it mean for two models to have adjacent time domains?</li>
<li>What if their spatial domains are separated?</li>
</ul></div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Example solution
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="section level3">
<h3 id="example-coupled-model">Example coupled model<a class="anchor" aria-label="anchor" href="#example-coupled-model"></a></h3>
<p>The sun drives local convection in the atmosphere by heating up the Earth’s surface, which then heats up the air above it. We can model how this plays out over the course of a day by coupling two models:</p>
<p>Model 1 simulates the heating of the Earth’s surface as the sun shines on it. Model 2 simulates the flow of the air above as it warms up and starts rising. In time, both domains extend from sunrise to sunset. In space, the heating process takes place on the Earth’s surface, while the airflow process operates on the atmosphere. In time, the domains overlap, while in space they are adjacent.</p>
</div>
<div class="section level3">
<h3 id="questions">Questions<a class="anchor" aria-label="anchor" href="#questions"></a></h3>
<ul><li>If two models have adjacent time domains, then one model starts at the same moment that the other ends. Typically, this occurs when one process triggers another.</li>
<li>If the spatial domains of two models are separated, then there is no direct exchange of information between the models, unless some kind of remote communication is possible. As a result, the models can be run separately and don’t need to be coupled, unless some other model has a domain adjacent to both.</li>
</ul></div>
</div>
</div>
</div>
</div>
</section><section id="scales"><h2 class="section-heading">Scales<a class="anchor" aria-label="anchor" href="#scales"></a>
</h2>
<hr class="half-width"><div id="accordionInstructor3" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor3" aria-expanded="false" aria-controls="collapseInstructor3">
  <h3 class="accordion-header" id="headingInstructor3">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Instructor Note
  </h3>
</button>
<div id="collapseInstructor3" class="accordion-collapse collapse" aria-labelledby="headingInstructor3" data-bs-parent="#accordionInstructor3">
<div class="accordion-body">
<ul><li>Grain and extent</li>
<li>Again, partly modelling decision</li>
</ul></div>
</div>
</div>
</div>
<p>A second important property of a physical process is the scales, again in time and in space, on which it takes place. A scale can be defined by its grain and extent. There are many other terms in use for these, but we’ll use these here because they’re less ambiguous than most. The <em>grain</em> refers to the smallest detail that the model can represent. In practice, that is usually set by the timestep (in time), grid spacing, or size of an agent (in space). If these can vary throughout the domain, pick the smallest. The <em>extent</em> refers to the size of the process in space and time, so the size of its domain. How long does it take to complete (or to reach a steady state), and how large an area is modelled?</p>
<div id="accordionInstructor4" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor4" aria-expanded="false" aria-controls="collapseInstructor4">
  <h3 class="accordion-header" id="headingInstructor4">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Instructor Note
  </h3>
</button>
<div id="collapseInstructor4" class="accordion-collapse collapse" aria-labelledby="headingInstructor4" data-bs-parent="#accordionInstructor4">
<div class="accordion-body">
<ul><li>Add to shared document</li>
</ul></div>
</div>
</div>
</div>
<div id="challenge-2-models-and-scales" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2-models-and-scales" class="callout-inner">
<h3 class="callout-title">Challenge 2: Models and scales<a class="anchor" aria-label="anchor" href="#challenge-2-models-and-scales"></a>
</h3>
<div class="callout-content">
<p>What are the scales of the models you previously considered the domains of? What are their grain and extent in space and in time?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Example solution
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="section level3">
<h3 id="surface">Surface<a class="anchor" aria-label="anchor" href="#surface"></a></h3>
<p>Model 1 simulates the heating of the Earth’s surface as the sun shines on it.</p>
<p>The temperature of the Earth’s surface only changes slowly during the day, and we can probably say there are no significant changes from one minute to the next, or even for a somewhat larger interval. So the time grain of model 1 is on the order of a few minutes, perhaps up to an hour. The time extent of the model is one day, as it will repeat itself after that.</p>
<p>In space, the grain depends on the research question, and could be as small as 10 cm if we are looking at the detailed thermal environment around a building, or as large as a few kilometers if we want to make a national weather forecast. The extent is the size of the area of study.</p>
</div>
<div class="section level3">
<h3 id="atmosphere">Atmosphere<a class="anchor" aria-label="anchor" href="#atmosphere"></a></h3>
<p>Model 2 simulates the flow of the air above as it warms up and starts rising. This is probably done using a computational fluid dynamics model. Both the temporal and spatial scales will depend on the research question here, and grains (time steps and grid spacing) may range from milliseconds and centimeters to minutes and kilometers. The spatial extent may be the same as that of Model 1, but it could be larger if a very tall column of air is modeled. In time, the atmosphere won’t reach a static equilibrium, but we could choose to run the simulation for the course of a day and use that as the temporal extent.</p>
<p>Note that you often cannot give an exact number, and that the scales are often something of a modeling decision. That’s usually alright, as we will see below.</p>
</div>
</div>
</div>
</div>
</div>
<p>Just like with domains, the scales of two models can be compared and their relation determined. The Scale Separation Map (SSM) is a nice tool for this. The SSM is a graph with on its horizontal axis a range of durations, and on its vertical axis a range of sizes. Each model can then be plotted as a box, with the left edge at the temporal grain, the right edge at the temporal extent, the lower edge at the spatial grain, and the upper edge at the spatial extent. Here is an example:</p>
<figure><img src="../fig/ep02-scale-separation-map.png" alt="2D plot with time on the horizontal axis and space on the vertical axis. In the center there is a box, which is surrounded by dashed boxes labelled a through h." class="figure mx-auto d-block"><figcaption>The Scale Separation Map. The box in the center depicts the scale of a given process or model, the dashed boxes show possible other scales and the corresponding relationships.</figcaption></figure><div id="accordionInstructor5" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor5" aria-expanded="false" aria-controls="collapseInstructor5">
  <h3 class="accordion-header" id="headingInstructor5">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Instructor Note
  </h3>
</button>
<div id="collapseInstructor5" class="accordion-collapse collapse" aria-labelledby="headingInstructor5" data-bs-parent="#accordionInstructor5">
<div class="accordion-body">
<ul><li>Time horizontal, space vertical</li>
<li>Plotting scales, so sizes, not locations!</li>
<li>Timestep and extent, grid spacing and size</li>
</ul></div>
</div>
</div>
</div>
<p>The SSM may look very counterintuitive at first, because we are used to plotting locations, not sizes. So look at the graph carefully and think about what you see and what it means. It does get easier to understand once you get the hang of it.</p>
<p>As you can see, we can plot multiple models on a Scale Separation Map and when we do, the map shows the relationship between the scales of two models. Both horizontally and vertically, model rectangles can have a gap between them (i.e. be separated), or be adjacent, or overlap, and the corresponding models are said to be scale separated, scale adjacent or scale overlapping in space and/or in time.</p>
<p>For coupling, it is actually only these relationships that matter. Even if you don’t know the exact grain or extent of a particular model, you can often decide whether it’s smaller, larger or the same as the grain or extent of another model and draw them correspondingly.</p>
<div id="accordionInstructor6" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor6" aria-expanded="false" aria-controls="collapseInstructor6">
  <h3 class="accordion-header" id="headingInstructor6">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Instructor Note
  </h3>
</button>
<div id="collapseInstructor6" class="accordion-collapse collapse" aria-labelledby="headingInstructor6" data-bs-parent="#accordionInstructor6">
<div class="accordion-body">
<ul><li>All together in class</li>
</ul></div>
</div>
</div>
</div>
<div id="challenge-3-scale-separation-map" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3-scale-separation-map" class="callout-inner">
<h3 class="callout-title">Challenge 3: Scale Separation Map<a class="anchor" aria-label="anchor" href="#challenge-3-scale-separation-map"></a>
</h3>
<div class="callout-content">
<ul><li>What are the relations of scales a through h in the figure relative to the reference scale?</li>
<li>Draw a scale separation map for the models you would like to couple.</li>
</ul></div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Example solution
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="section level3">
<h3 id="scale-relations">Scale relations<a class="anchor" aria-label="anchor" href="#scale-relations"></a></h3>
<ol style="list-style-type: lower-alpha"><li>Spatially (larger) and temporally (faster) scale separated.</li>
<li>Spatially scale adjacent (larger), temporally scale overlapping.</li>
<li>Spatially scale adjacent (larger), temporally scale adjacent (larger).</li>
<li>Spatially scale overlapping, temporally scale adjacent (smaller).</li>
<li>Spatially scale overlapping, temporally scale separated (slower).</li>
<li>Spatially and temporally scale overlapping.</li>
<li>Spatially scale adjacent (smaller) and temporally scale separated (faster).</li>
<li>Spatially scale separated (smaller) and temporally scale adjacent (slower).</li>
</ol></div>
<div class="section level3">
<h3 id="scale-separation-map">Scale Separation Map<a class="anchor" aria-label="anchor" href="#scale-separation-map"></a></h3>
<figure><img src="../fig/ep02-scale-separation-map-solution.png" alt="2D plot showing one large box for the atmosphere model, ranging from 1 second to 1 day and 10 cm to 100 m, and a smaller overlapping box for the surface heating model ranging from 10 mn to 1 day and 1m to 100m." class="figure mx-auto d-block"><figcaption>Scale Separation Map for the atmosphere/surface model.</figcaption></figure></div>
</div>
</div>
</div>
</div>
</section><section id="models-and-the-submodel-execution-loop"><h2 class="section-heading">Models and the Submodel Execution Loop<a class="anchor" aria-label="anchor" href="#models-and-the-submodel-execution-loop"></a>
</h2>
<hr class="half-width"><div id="accordionInstructor7" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor7" aria-expanded="false" aria-controls="collapseInstructor7">
  <h3 class="accordion-header" id="headingInstructor7">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Instructor Note
  </h3>
</button>
<div id="collapseInstructor7" class="accordion-collapse collapse" aria-labelledby="headingInstructor7" data-bs-parent="#accordionInstructor7">
<div class="accordion-body">
<ul><li>Model of a computational model</li>
<li>Explain operators</li>
<li>Begin/end vs. inside state update loop</li>
<li>Filled output vs. open input</li>
<li>Quite flexible</li>
</ul></div>
</div>
</div>
</div>
<p>So far, we have talked about domains and scales of models, which we can do based on the physical properties of the modelled system, and the research questions we ask about that system. In order to be able to technically couple models however, we need to know what a model is. In the MMSF, this is done using a universal model-of-a-model called the Submodel Execution Loop (SEL):</p>
<figure><img src="../fig/ep02-submodel-execution-loop.png" alt="Diagram showing a diamond marked f init, a circle marked O i, another circle marked S, and another diamond marked O f connected by arrows in order. Another arrow loops back from S to O i. A dashed arrow points into f init, another dashed arrow points away from O i, another points into S and a fourth dashed arrow points away from O f. The circle marked O i and the diamond marked O f are white on black, the others black on white." class="figure mx-auto d-block"><figcaption>Submodel Execution Loop (SEL)</figcaption></figure><p>According to the MMSF, each model starts by initialising itself, a stage (or <em>operator</em>) known as <span class="math inline">\(f_{init}\)</span>. This puts the model into its initial state. During <span class="math inline">\(f_{init}\)</span>, information may be received from other models in a coupled simulation, which the model can use to initialise itself.</p>
<p>Second, some output based on that state is produced in the <span class="math inline">\(O_i\)</span> operator. This is <strong>i</strong>ntermediate Output, or, looking from the outside in, we Observe an <strong>i</strong>ntermediate state, hence <span class="math inline">\(O_i\)</span>. This output may be sent to other models, where it can for example be used as boundary conditions.</p>
<p>Third, a state update may be performed using the <span class="math inline">\(S\)</span> operator, which moves the model to its next state (timestep). During <span class="math inline">\(S\)</span>, information may be received from other models to help perform the state update.</p>
<p>After <span class="math inline">\(S\)</span>, the model may loop back to before <span class="math inline">\(O_i\)</span>, and repeat those two operators for a while, until the end of the time scale is reached. This leaves the model with a final state, which may be output in the <span class="math inline">\(O_f\)</span> operator (for <strong>f</strong>inal output or observation).</p>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>Note that there’s a mnemonic here for the symbols: Operators <span class="math inline">\(O_i\)</span> and <span class="math inline">\(S\)</span>, which are within the state update loop, have a circular symbol, while <span class="math inline">\(f_{init}\)</span> and <span class="math inline">\(O_f\)</span> use a diamond shape. Also, filled symbols designate ports on which messages are sent, while open symbols designate receiving ports. Information must always be sent from an operator with a filled symbol to one with an open symbol.</p>
</div>
</div>
</div>
<p>This basic model is quite flexible. If the loop is run zero times, then the model is a simple function. Timesteps may be of any length, and vary during the run, and the model may decide to stop and exit the state update loop at any time. The state may represent anything at all in any way, and it may be updated in whichever way is suitable for the model. Any simulation code you may want to use is very likely to fit these minimal constraints.</p>
</section><section id="temporal-domain-and-scale-relations"><h2 class="section-heading">Temporal domain and scale relations<a class="anchor" aria-label="anchor" href="#temporal-domain-and-scale-relations"></a>
</h2>
<hr class="half-width"><div id="accordionInstructor8" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor8" aria-expanded="false" aria-controls="collapseInstructor8">
  <h3 class="accordion-header" id="headingInstructor8">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Instructor Note
  </h3>
</button>
<div id="collapseInstructor8" class="accordion-collapse collapse" aria-labelledby="headingInstructor8" data-bs-parent="#accordionInstructor8">
<div class="accordion-body">
<ul><li>How to connect two SELs?</li>
<li>Time scales and domains are the most interesting part</li>
<li>Update shared document with SEL connections, but after giving everyone a bit of time to think</li>
<li>Three scenarios
<ul><li>Adjacent or separated time domains</li>
<li>Overlapping domains and same time scale</li>
<li>Overlapping domains and time scale separation</li>
</ul></li>
</ul></div>
</div>
</div>
</div>
<p>Now that we know what a model is and how models may be related in terms of their domains and scales, we can decide how to set up the coupled simulation. We do this by looking at all pairs of two models under consideration, one pair at a time, and consider the relationships between their temporal and spatial scales as well as their domains.</p>
<p>For reference, here are the possible relations between two time domains or two time scales:</p>
<table class="table"><colgroup><col width="29%"><col width="29%"><col width="40%"></colgroup><thead><tr class="header"><th>Property</th>
<th>Relation</th>
<th>Description</th>
</tr></thead><tbody><tr class="odd"><td>Domain</td>
<td>Same</td>
<td>At the same time, acting on the exact same bit of reality</td>
</tr><tr class="even"><td>Domain</td>
<td>Overlap</td>
<td>Some parts at the same time, acting on the same bit of reality</td>
</tr><tr class="odd"><td>Domain</td>
<td>Adjacent</td>
<td>One starting precisely when the other ends</td>
</tr><tr class="even"><td>Domain</td>
<td>Separated</td>
<td>One starting some time after the other ends</td>
</tr><tr class="odd"><td>Scale</td>
<td>Same</td>
<td>Same grain (dt) and extent (duration)</td>
</tr><tr class="even"><td>Scale</td>
<td>Overlap</td>
<td>Grain or extent differs, but neither model has a grain larger than the extent of the other or an extent smaller than the grain of the other</td>
</tr><tr class="odd"><td>Scale</td>
<td>Adjacent</td>
<td>One model’s extent equals the other’s grain</td>
</tr><tr class="even"><td>Scale</td>
<td>Separated</td>
<td>One model’s extent is smaller than the other model’s grain</td>
</tr></tbody></table><p>Of the different properties, those governing time are the most interesting, and also potentially the most confusing. Let’s look at the possible scenarios one by one.</p>
<div class="section level3">
<h3 id="adjacent-or-separated-time-domains">Adjacent or separated time domains<a class="anchor" aria-label="anchor" href="#adjacent-or-separated-time-domains"></a></h3>
<p>A simple case is when the time domains are adjacent, meaning one process starts right when the other process finishes, or separated, meaning one process starts some time after the other process finishes. In this case, the final output of the first model is used to initialise the subsequent model.</p>
</div>
<div class="section level3">
<h3 id="same-time-domains-and-the-same-temporal-scale">Same time domains and the same temporal scale<a class="anchor" aria-label="anchor" href="#same-time-domains-and-the-same-temporal-scale"></a></h3>
<p>If two processes do not happen one after the other, then they occur at least partially simultaneously, and their models have overlapping time domains. The simplest among these cases is when the two processes start and end at the same time, and have the same timestep. In that case, each model updates its state to the next timestep, then sends some information based on the new state (e.g. boundary conditions) to the other model, receives information from the other model in return, and goes to do the next state update.</p>
</div>
<div class="section level3">
<h3 id="same-time-domains-and-temporal-scale-separation">Same time domains and temporal scale separation<a class="anchor" aria-label="anchor" href="#same-time-domains-and-temporal-scale-separation"></a></h3>
<p>A third interesting case is when two processes happen at the same time, but one process is much faster than the other, so that it runs to completion in (much) less time than it takes the other to do a timestep. In that case, the fast model needs to do an entire run for every timestep of the slow model.</p>
<div id="challenge-4-coupling-submodel-execution-loops" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4-coupling-submodel-execution-loops" class="callout-inner">
<h3 class="callout-title">Challenge 4: Coupling Submodel Execution Loops<a class="anchor" aria-label="anchor" href="#challenge-4-coupling-submodel-execution-loops"></a>
</h3>
<div class="callout-content">
<p>We can represent each of the two models in the scenarios above as a Submodel Execution Loop. To connect the models, we then have to send information between the operators of the models. For each of the three cases, figure out how to connect the Submodel Execution Loops of the two models so that the correct communication pattern is implemented.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Example solution
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>If the time domains are adjacent or separated, then the final output of the first model is used to initialise the subsequent model. We can implement this by sending information from the first model’s <span class="math inline">\(O_f\)</span> to the second model’s <span class="math inline">\(f_{init}\)</span>.</p>
<p>If the temporal scales are the same, then the models exchange information every time they have a new state. This can be done by connecting each model’s <span class="math inline">\(O_i\)</span> to the other model’s <span class="math inline">\(S\)</span>, thus sending information at each step.</p>
<p>In case of temporal scale separation, the fast model needs to be reinitialised at every timestep of the slow model, do an entire run, and return some information based on its final state to the slow model. This can be accomplished by sending from the slow model’s <span class="math inline">\(O_i\)</span> to the fast model’s <span class="math inline">\(f_{init}\)</span> and from the fast model’s <span class="math inline">\(O_f\)</span> back to the slow model’s <span class="math inline">\(S\)</span>.</p>
</div>
</div>
</div>
</div>
</div>
</section><section id="coupling-templates"><h2 class="section-heading">Coupling Templates<a class="anchor" aria-label="anchor" href="#coupling-templates"></a>
</h2>
<hr class="half-width"><div id="accordionInstructor9" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor9" aria-expanded="false" aria-controls="collapseInstructor9">
  <h3 class="accordion-header" id="headingInstructor9">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Instructor Note
  </h3>
</button>
<div id="collapseInstructor9" class="accordion-collapse collapse" aria-labelledby="headingInstructor9" data-bs-parent="#accordionInstructor9">
<div class="accordion-body">
<ul><li>Three scenarios use four coupling templates</li>
<li>Explain them, see picture</li>
<li>These are all the possibilities!</li>
</ul></div>
</div>
</div>
</div>
<figure><img src="../fig/ep02-coupling-templates.png" alt="Three diagrams of the coupling templates. Each diagram shows two submodel execution loops. The first diagram is titled Dispatch. In it, O_F on the first SEL is connected to F_INIT on the second SEL. The second diagram is titled Interact. In it, O_I on each SEL is connected to S on the other. The third diagram is titled Call and Release. O_I on the first SEL is connected to F_INIT on the second, this is Call. O_F on the second SEL is connected to S on the first, this is Release." class="figure mx-auto d-block"><figcaption>Coupling Templates</figcaption></figure><p>The three cases above demonstrate the four <em>Coupling Templates</em> defined by the MMSF. The first one, <span class="math inline">\(O_f\)</span> to <span class="math inline">\(f_{init}\)</span>, is called <em>dispatch</em>. The second one, <span class="math inline">\(O_i\)</span> to <span class="math inline">\(S\)</span> is called <em>interact</em>, and usually comes in pairs. The third one and the fourth one usually go together, as the combination <em>call</em> (<span class="math inline">\(O_i\)</span> to <span class="math inline">\(f_{init}\)</span>) and <em>release</em> (<span class="math inline">\(O_f\)</span> to <span class="math inline">\(S\)</span>).</p>
<p>Given the constraints of which operators can send and which can receive, these are in fact all four possible types of connections, and between them they cover all kinds of temporal scale relations.</p>
<p>If the time domains or time scales overlap, but are not equivalent, then an additional component is needed that sits between the models; we will not go into that advanced use case here.</p>
</section><section id="spatial-domains-scales-and-multiplicity"><h2 class="section-heading">Spatial domains, scales and multiplicity<a class="anchor" aria-label="anchor" href="#spatial-domains-scales-and-multiplicity"></a>
</h2>
<hr class="half-width"><div id="accordionInstructor10" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor10" aria-expanded="false" aria-controls="collapseInstructor10">
  <h3 class="accordion-header" id="headingInstructor10">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Instructor Note
  </h3>
</button>
<div id="collapseInstructor10" class="accordion-collapse collapse" aria-labelledby="headingInstructor10" data-bs-parent="#accordionInstructor10">
<div class="accordion-body">
<ul><li>Space is also important of course</li>
<li>Again three scenarios
<ul><li>Same domain and scale
<ul><li>May be best to make a single program</li>
</ul></li>
<li>Same spatial domain, adjacent or separated scales
<ul><li>Multiple instances of the small one!</li>
</ul></li>
<li>Adjacent spatial domains, same or overlapping spatial scales
<ul><li>For time-scale separation, the fast model needs to keep state!</li>
</ul></li>
</ul></li>
<li>These determine:
<ul><li>How many instances there are of each model</li>
<li>Whether state or boundary conditions are exchanged</li>
</ul></li>
<li>Challenge 5: Find examples in the shared document</li>
</ul></div>
</div>
</div>
</div>
<p>Having discussed temporal scales, let’s move on to the spatial scales. Like with scales in time, scales in space can be the same, overlap, be adjacent or be separated, and you can see which one you have by looking at your Scale Separation Map. Here’s another table with the interpretation of those relations in space:</p>
<table class="table"><colgroup><col width="29%"><col width="29%"><col width="40%"></colgroup><thead><tr class="header"><th>Property</th>
<th>Relation</th>
<th>Description</th>
</tr></thead><tbody><tr class="odd"><td>Domain</td>
<td>Same</td>
<td>In the same place, acting on the exact same bit of reality</td>
</tr><tr class="even"><td>Domain</td>
<td>Overlap</td>
<td>Some parts in the same place, acting on the same bit of reality</td>
</tr><tr class="odd"><td>Domain</td>
<td>Adjacent</td>
<td>Acting on two different bits of reality which touch each other (space)</td>
</tr><tr class="even"><td>Domain</td>
<td>Separated</td>
<td>Acting on two different bits of reality which do not touch (space)</td>
</tr><tr class="odd"><td>Scale</td>
<td>Same</td>
<td>Same grain (dx) and extent (size)</td>
</tr><tr class="even"><td>Scale</td>
<td>Overlap</td>
<td>Grain or extent differs, but neither model has a grain larger than the extent of the other or an extent smaller than the grain of the other</td>
</tr><tr class="odd"><td>Scale</td>
<td>Adjacent</td>
<td>One model’s extent equals the other’s grain</td>
</tr><tr class="even"><td>Scale</td>
<td>Separated</td>
<td>One model’s extent is smaller than the other model’s grain</td>
</tr></tbody></table><div class="section level3">
<h3 id="same-spatial-domain-and-scale">Same spatial domain and scale<a class="anchor" aria-label="anchor" href="#same-spatial-domain-and-scale"></a></h3>
<p>This is a very tight coupling, where usually the two processes end up in a single equation on the theory side, and in a single code in the implementation. Unless there is temporal scale separation, it’s probably better to combine the models into a single implementation. In case of temporal scale separation, a call-and-release template may be used and the state is passed back and forth between the models.</p>
</div>
<div class="section level3">
<h3 id="same-spatial-domain-adjacent-or-separated-scales">Same spatial domain, adjacent or separated scales<a class="anchor" aria-label="anchor" href="#same-spatial-domain-adjacent-or-separated-scales"></a></h3>
<p>If one process is much smaller than the other, then the entire small process takes place within one grid cell or agent of the larger process. Frequently, this means that there are multiple instances of the smaller model, maybe even one for each grid cell or agent, with communication between the large-scale model and each small-scale model instance. Some kind of iterative equilibration between the models may be needed to reconcile the two representations of the state.</p>
</div>
<div class="section level3">
<h3 id="adjacent-spatial-domains-same-or-overlapping-spatial-scales">Adjacent spatial domains, same or overlapping spatial scales<a class="anchor" aria-label="anchor" href="#adjacent-spatial-domains-same-or-overlapping-spatial-scales"></a></h3>
<p>If two processes are of similar size and resolution, but occur on adjacent domains, then they will each have their own state, and exchange boundary conditions. If there’s a temporal scale separation between them, then the call-and-release coupling template is used and the called (fast) model keeps its state in between calls.</p>
<div id="challenge-5-spatial-relations" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-5-spatial-relations" class="callout-inner">
<h3 class="callout-title">Challenge 5: Spatial relations<a class="anchor" aria-label="anchor" href="#challenge-5-spatial-relations"></a>
</h3>
<div class="callout-content">
<p>Think of an example for each of the above spatial domain and scale relations. Can you think of examples that don’t fit any of them?</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  Example solution
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<ul><li>Reaction-diffusion models have the two processes acting on the same domain and spatial scale, but may be temporally scale-separated depending on parameter values.</li>
<li>A crack propagation model coupling a continuum representation of a material sample to molecular mechanics models at specific points. Stresses and strains are exchanged in this case.</li>
<li>In a simulation of In-Stent Restenosis, a complication of vascular surgery, a cell growth process in the wall of an artery is coupled with a fluid dynamics simulation of the blood flow through the artery. The domains are adjacent and boundary conditions are exchanged.</li>
</ul></div>
</div>
</div>
</div>
</div>
</section><section id="mmsl-diagrams"><h2 class="section-heading">MMSL Diagrams<a class="anchor" aria-label="anchor" href="#mmsl-diagrams"></a>
</h2>
<hr class="half-width"><div id="accordionInstructor11" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor11" aria-expanded="false" aria-controls="collapseInstructor11">
  <h3 class="accordion-header" id="headingInstructor11">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Instructor Note
  </h3>
</button>
<div id="collapseInstructor11" class="accordion-collapse collapse" aria-labelledby="headingInstructor11" data-bs-parent="#accordionInstructor11">
<div class="accordion-body">
<ul><li>There’s a diagram language for showing coupled models: gMMSL</li>
<li>Explain the diagram together (in the shared document)</li>
</ul></div>
</div>
</div>
</div>
<p>For larger coupled simulations consisting of several submodels and other components, drawing the complete submodel execution loop as we did above gets too complicated. Fortunately, a simplified notation is available in the form of the Multiscale Modelling and Simulation Language (MMSL). This language describes a coupled simulation as a set of components and the connections between them. Its YAML-based form, yMMSL, is used as the configuration language for MUSCLE3 (more on which in the next episodes). Its graphical form, gMMSL, provides a compact visual representation of a coupled model:</p>
<figure><img src="../fig/ep02-coupling-templates-mmsl.png" alt="Three diagrams of the coupling templates, this time in gMMSL. Each diagram shows two boxes. The top diagram is labelled dispatch and has the boxes labeled First and Second. A line connects a filled diamond on the box labelled first to an open diamond on the box labelled second. The bottom left diagram is labelled interact and has the boxes labeled A and B. A line connects a filled circle on box A to an open circle on box B, and another line connects a closed circle on box B to an open circle on box A. The bottom right diagram is labelled Call and Release. Its boxes are labelled Macro and Micro. A line connects a closed circle on Macro to an open diamond on Micro, and another line connects a filled diamond on Micro to an open circle on Macro. The box labeled Micro additionally has the number 10 written in its top right corner." class="figure mx-auto d-block"><figcaption>Coupling Templates in gMMSL</figcaption></figure><div id="challenge-6-deciphering-gmmsl" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-6-deciphering-gmmsl" class="callout-inner">
<h3 class="callout-title">Challenge 6: Deciphering gMMSL<a class="anchor" aria-label="anchor" href="#challenge-6-deciphering-gmmsl"></a>
</h3>
<div class="callout-content">
<p>Explain the above figure.</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  Example solution
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<p>Each box represents a submodel. The lines show where information is sent from one model to another. The diamonds and circles designate the SEL operators that information is sent from and to. A number in the top right corner of a box is optional, but when it’s there it shows how many instances of that submodel exist. In this case, the model at the bottom right has temporal and spatial scale separation, so it uses the call-and-release coupling template and has multiple instances of the micromodel.</p>
</div>
</div>
</div>
</div>
<p>Note that there can be multiple lines or <em>conduits</em> between the same operators and models if multiple bits of information need to be transferred, but then these could also be glued together into a single message. This is a modelling decision, so do what works best for your model.</p>
<p>Not shown in the diagram is that the lines can be labeled with a label at each end showing the name of the <em>port</em> on the model that is being connected. Especially if there are multiple lines then it is necessary to do that to avoid confusion. More about this in the following episodes, when we connect two models using MUSCLE3.</p>
<div id="callout2" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout2"></a>
</h3>
<div class="callout-content">
<p>Real simulations often need more than just the submodels, especially if you want to keep everything nice and modular. Different models often send and receive data in different formats for example, so that you need converters, and sometimes splitters and joiners that can split messages or join them together. If there is a scale difference, then some kind of scale bridge usually needs to be implemented, and for uncertainty quantification components may be needed that sample parameters and combine results into distributions.</p>
<p>These components are often simple functions, and can then be implemented just like a submodel with only an <span class="math inline">\(f_{init}\)</span> and <span class="math inline">\(O_f\)</span>. Such a component can then be inserted in between a connection between two submodels by interrupting a conduit and putting it in between.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>Physical processes take place on a domain and at certain scales in time and space</li>
<li>Simulation models are described by the Submodel Execution Loop</li>
<li>Given two models and their domains and scales, we can decide which coupling template to use to connect them</li>
<li>An MMSL diagram can be used to visualise a complete coupled simulation</li>
</ul></div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/01-introduction.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/03-muscle-connect.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/01-introduction.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Introduction to
        </a>
        <a class="chapter-link float-end" href="../instructor/03-muscle-connect.html" rel="next">
          Next: MUSCLE3 - connecting... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/esciencecenter-digital-skills/lesson-model-coupling/edit/main/episodes/02-theory.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/esciencecenter-digital-skills/lesson-model-coupling/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/esciencecenter-digital-skills/lesson-model-coupling/" class="external-link">Source</a></p>
				<p><a href="https://github.com/esciencecenter-digital-skills/lesson-model-coupling/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:training@esciencecenter.nl">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="../LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.14.1" class="external-link">sandpaper (0.14.1)</a>,
        <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>,
      and <a href="https://github.com/carpentries/varnish/tree/0.3.3" class="external-link">varnish (0.3.3)</a>.</p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://esciencecenter-digital-skills.github.io/lesson-model-coupling/instructor/02-theory.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "multiscale, modeling, simulation, coupling, multiphyiscs",
  "name": "Model coupling theory: the Multiscale Modelling and Simulation Framework",
  "creativeWorkStatus": "active",
  "url": "https://esciencecenter-digital-skills.github.io/lesson-model-coupling/instructor/02-theory.html",
  "identifier": "https://esciencecenter-digital-skills.github.io/lesson-model-coupling/instructor/02-theory.html",
  "dateCreated": "2022-08-16",
  "dateModified": "2022-10-31",
  "datePublished": "2023-11-28"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

